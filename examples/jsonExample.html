<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Web Programming - CSci 130 - AJAX</title>
</head>
<body >
<!-- Basic form: -->

<table>

<tr>
<td colspan=2><label>Name: <input type="text" id="firstname" /> </label><td>
<tr>

<tr>
<td>Example: 'GET','csvjson.json'</td>
<td><button id="bt01" type="button" onclick="MyFunction(1)">Make a request to the server</button></td>
</tr>

</table>

<!-- Example with AJAX to load different types of documents -->

<script>
//(function() {
  var httpRequest;
  // Access the button through the DOM 
  // Element with ID bt01
  // Assign a function (makeRequest) to the event (click)
    
  var typedoc; 
  // 1: for HTML example
  // 2: for XML example
  // 3: for PHP example
  
  
// XMLHttpRequest.readyState property 
//0:	UNSENT	Client has been created. open() not called yet.
//1:	OPENED	open() has been called.
//2:	HEADERS_RECEIVED	send() has been called, and headers and status are available.
//3:	LOADING	Downloading; responseText holds partial data.
//4:	DONE
   
// Status:   
// https://developer.mozilla.org/en-US/docs/Web/HTTP/Status
  
  function MyFunction(x) {  
    typedoc=x;
	// Use the DOM functions to retrieve a particular field, place it in a javascript variable, so we can send it to the server 
    var userName = document.getElementById("firstname").value; // content of the value of the input text field which has the ID firstname
	if (typedoc==1)
		makeRequest1();
		// PHP case where the request as an input, here we have a single variable, 
		// but for complicated forms we have an object that contains the different fields in a form for instance 
  }
  
  
  // As you can see, there are many common points between the functions !
  
  // XMLHttpRequests are asynchronous by default
  // They are only placed in synchronous mode by passing false as the value of the optional async parameter when calling open().

  function makeRequest1() {
    httpRequest = new XMLHttpRequest(); // create the object
    if (!httpRequest) { // check if the object was properly created
	  // issues with the browser, example: old browser
      alert('Cannot create an XMLHTTP instance');
      return false;
    }
    httpRequest.onreadystatechange = alertContents1; // we assign a function to the property onreadystatechange (callback function)
	httpRequest.open('GET','csvjson.json'); // Use a file in reference to the page where you are!
	httpRequest.send(); // GET = send with no parameter !
  }
  
  // Definition of the callback function:
function alertContents1() {
  try {
    if (httpRequest.readyState === XMLHttpRequest.DONE) {
      if (httpRequest.status === 200) {      
			//alert(httpRequest.responseText); // Display the textual information from the httpRequest (just a basic alert function)
			// You can parse manually what is returned: waste of time --> structure the information so you can access to all you need directly

      var myArray=JSON.parse(httpRequest.responseText);
      FillTable(myArray);
	  } else {
        alert('There was a problem with the request.');
      }
    }
  }
  catch( e ) { // Always deal with what can happen badly, client-server applications --> there is always something that can go wrong on one end of the connection
    alert('Caught Exception: ' + e.description);
  }
}

function FillTable(myArray){
  var table = document.createElement("table"); // Create a table element
  var headers = Object.keys(myArray[0]); // Get headers from the keys of the first object

  // Create table header
  var headerRow = document.createElement("tr"); // Corrected to create a table row
  headers.forEach(function(header){
    var th = document.createElement("th"); // Corrected to create a table header element
    th.appendChild(document.createTextNode(header)); // Insert text into header cell
    headerRow.appendChild(th); // Append header cell to the header row
  });
  table.appendChild(headerRow); // Append header row to the table
  
  // Create table rows for data
  myArray.forEach(function(item) {
    var row = document.createElement("tr");
    headers.forEach(function(header) {
      var td = document.createElement("td"); // Create a table data cell
      td.appendChild(document.createTextNode(item[header])); // Insert data into the cell
      row.appendChild(td); // Append cell to the row
    });
    table.appendChild(row); // Append row to the table
  });

  // Append the table to the body or to a specific element
  document.body.appendChild(table);
}


//})();
</script>

</body>
</html>